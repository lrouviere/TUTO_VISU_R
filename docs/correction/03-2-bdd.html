<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Visualisation avec R - 5&nbsp; Base de données</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./04-ggplot.html" rel="next">
<link href="./031-programmer.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Pas de résultats",
    "search-matching-documents-text": "documents trouvés",
    "search-copy-link-title": "Copier le lien vers la recherche",
    "search-hide-matches-text": "Cacher les correspondances additionnelles",
    "search-more-match-text": "correspondance de plus dans ce document",
    "search-more-matches-text": "correspondances de plus dans ce document",
    "search-clear-button-title": "Effacer",
    "search-detached-cancel-button-title": "Annuler",
    "search-submit-button-title": "Envoyer",
    "search-label": "Recherche"
  }
}</script>
<script src="site_libs/htmlwidgets-1.6.3/htmlwidgets.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="site_libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="site_libs/leaflet-1.3.1/leaflet.js"></script>
<link href="site_libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="site_libs/proj4-2.6.2/proj4.min.js"></script>
<script src="site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="site_libs/leaflet-binding-2.2.1/leaflet.js"></script>
<script src="site_libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="site_libs/leaflet-providers-plugin-2.2.1/leaflet-providers-plugin.js"></script>
<link href="site_libs/HomeButton-0.0.1/home-button.css" rel="stylesheet">
<script src="site_libs/HomeButton-0.0.1/home-button.js"></script>
<script src="site_libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<script src="site_libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="site_libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet">
<link href="site_libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="style.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./01-intro.html">Logiciel R</a></li><li class="breadcrumb-item"><a href="./03-2-bdd.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Base de données</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Visualisation avec R</a> 
        <div class="sidebar-tools-main tools-wide">
    <div class="dropdown">
      <a href="" title="Download" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download"><i class="bi bi-download"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./Visualisation-avec-R.pdf">
              <i class="bi bi-bi-file-pdf pe-1"></i>
            Download PDF
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./Visualisation-avec-R.epub">
              <i class="bi bi-bi-journal pe-1"></i>
            Download ePub
            </a>
          </li>
      </ul>
    </div>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-1" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-1">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Basculer en mode lecteur">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Recherche"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Présentation</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Logiciel R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Basculer la section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-objetsR.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Les objets R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-dplyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Manipuler les données avec dplyr</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./031-programmer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Programmer</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-2-bdd.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Base de données</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Visualisation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Basculer la section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-ggplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Visualisation avec ggplot2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-carto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Faire des cartes avec R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-interactif.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Quelques outils de visualisation dynamique/interactive</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-shiny.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Applications web avec Shiny</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Statistique avec R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Basculer la section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Estimation et intervalles de confiance</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Régression avec R</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Références</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table des matières</h2>
   
  <ul>
  <li><a href="#sql-structured-query-language" id="toc-sql-structured-query-language" class="nav-link active" data-scroll-target="#sql-structured-query-language"><span class="header-section-number">5.1</span> SQL : Structured Query Language</a>
  <ul class="collapse">
  <li><a href="#requêtes-sql" id="toc-requêtes-sql" class="nav-link" data-scroll-target="#requêtes-sql"><span class="header-section-number">5.1.1</span> Requêtes SQL</a></li>
  <li><a href="#requêter-avec-dplyr" id="toc-requêter-avec-dplyr" class="nav-link" data-scroll-target="#requêter-avec-dplyr"><span class="header-section-number">5.1.2</span> Requêter avec dplyr</a></li>
  </ul></li>
  <li><a href="#exercices" id="toc-exercices" class="nav-link" data-scroll-target="#exercices"><span class="header-section-number">5.2</span> Exercices</a></li>
  <li><a href="#json-javascript-object-notation" id="toc-json-javascript-object-notation" class="nav-link" data-scroll-target="#json-javascript-object-notation"><span class="header-section-number">5.3</span> JSON : JavaScript Object Notation</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-bdd" class="quarto-section-identifier"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Base de données</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">

</div>
<style>
div.correction {
  color: black;
  background-color: #F0F0F0;
  font-style: normal;
  /*display: none;*/
}

.corR {
  font-style: italic;
  /*display: none;*/
}
</style>
<p>Les données requises pour les analyses sont souvent stockées dans des bases de données. <strong>R</strong> propose différents outils permettant d’accéder à ces bases de données. On présente dans cette partie le package <code>DBI</code> qui permet de se connecter à des bases de type <strong>SQL</strong> ainsi que la manière d’appréhender des données au format <strong>JSON</strong>.</p>
<section id="sql-structured-query-language" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="sql-structured-query-language"><span class="header-section-number">5.1</span> SQL : Structured Query Language</h2>
<p>La package <code>DBI</code> (DataBase Interface) offre une <em>interface de communication</em> entre <strong>R</strong> et différentes bases de données de type SQL à l’aide de pilotes dédiés : <a href="https://dbi.r-dbi.org" class="uri">https://dbi.r-dbi.org</a>. <strong>R</strong> possède différents packages permettant d’accéder à des bases SQL :</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">Base</th>
<th style="text-align: center;">Package</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">MysSQL</td>
<td style="text-align: center;">RMySQL</td>
</tr>
<tr class="even">
<td style="text-align: center;">MariaDB</td>
<td style="text-align: center;">RMariaDB</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Postgres</td>
<td style="text-align: center;">RPostgres</td>
</tr>
<tr class="even">
<td style="text-align: center;">SQLite</td>
<td style="text-align: center;">RSQLite</td>
</tr>
</tbody>
</table>
<p><strong>DBI</strong> propose une manière unifiée d’accéder à ces différentes bases en précisant le nom de la base de données, le nom de l’hôte, le port ) écouter ainsi que l’identifiant et le mot de passe de l’utilisateur. Par exemple, dans le cas d’une base <code>PostGreSQL</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  RPostgres<span class="sc">::</span><span class="fu">Postgres</span>(),</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dbname =</span> <span class="st">"DATABASE_NAME"</span>,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">host =</span> <span class="st">"HOST"</span>,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">port =</span> <span class="dv">5432</span>,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">user =</span> <span class="st">"USERNAME"</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">password =</span> <span class="st">"PASSWORD"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Afin de simplifier les choses, on propose de se connecter à une base de données éphémère créée en mémoire vive :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DBI)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(RSQLite<span class="sc">::</span><span class="fu">SQLite</span>(), <span class="at">dbname =</span> <span class="st">":memory:"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>À ce stade la base ne contient aucune table :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbListTables</span>(con)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>character(0)</code></pre>
</div>
</div>
<p>On peuple la base de deux tables simples :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>tbl1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">ID=</span><span class="fu">sample</span>(LETTERS),<span class="at">age=</span><span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>,<span class="dv">26</span>))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>tbl2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">ID=</span><span class="fu">sample</span>(LETTERS),<span class="at">taille=</span><span class="fu">sample</span>(<span class="dv">160</span><span class="sc">:</span><span class="dv">180</span>,<span class="dv">26</span>,<span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">runif</span>(<span class="dv">25</span>),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>), <span class="at">size =</span> <span class="dv">25</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">dbWriteTable</span>(con, <span class="at">name =</span> <span class="st">"table1"</span>,<span class="at">value =</span> tbl1)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="fu">dbWriteTable</span>(con, <span class="at">name =</span> <span class="st">"table2"</span>,<span class="at">value =</span> tbl2)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="fu">dbListTables</span>(con)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "table1" "table2"</code></pre>
</div>
</div>
<p>On peut lire la liste des colonnes d’une table avec</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbListFields</span>(con,<span class="st">"table1"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ID"  "age"</code></pre>
</div>
</div>
<p>Il est possible de lire la table avec</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbReadTable</span>(con,<span class="st">"table1"</span>) <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ID age
1  P   5
2  V  66
3  E  47
4  L  40
5  O  84
6  I  48</code></pre>
</div>
</div>
<section id="requêtes-sql" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="requêtes-sql"><span class="header-section-number">5.1.1</span> Requêtes SQL</h3>
<p><code>DBI</code> permet d’effectuer des requêtes SQL du genre</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> j <span class="kw">FROM</span> df <span class="kw">WHERE</span> i <span class="kw">GROUP</span> <span class="kw">BY</span> <span class="kw">by</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>sur les bases de données. Par exemple</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>req1 <span class="ot">&lt;-</span> <span class="fu">dbSendQuery</span>(con,<span class="st">"SELECT * FROM table1 WHERE age&gt;85"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>req1</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQLiteResult&gt;
  SQL  SELECT * FROM table1 WHERE age&gt;85
  ROWS Fetched: 0 [incomplete]
       Changed: 0</code></pre>
</div>
</div>
<p>On peut collecter, ramener vers <strong>R</strong>, les données issues de la requête avec <code>dbFetch</code> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>res1 <span class="ot">&lt;-</span> <span class="fu">dbFetch</span>(req1)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(res1)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>res1</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ID age
1  F  87
2  M  96</code></pre>
</div>
</div>
<p>La requête peut être soumise et exécutée directement avec <code>dbGetQuery</code> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(con,<span class="st">"SELECT * FROM table1 WHERE age&gt;85"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ID age
1  F  87
2  M  96</code></pre>
</div>
</div>
<p>À titre d’autre exemple, on peut effectuer une jointure des deux tables de la base avec</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con,<span class="st">"</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="st">                   SELECT *</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="st">                   FROM table1</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="st">                   INNER JOIN table2 ON table1.id = table2.id</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="st">                   ORDER BY ID</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="st">                   "</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ID age ID taille
1  A  26  A    180
2  B  32  B    165
3  C  80  C    167
4  D  72  D    165
5  E  47  E    180
6  F  87  F    161</code></pre>
</div>
</div>
<p><code>DBI</code> possède de nombreuses autres fonctions pour gérer les bases de données, par exemple</p>
<ul>
<li><code>dbExistsTable(con,name)</code> <span class="math inline">\(\Longrightarrow\)</span> vérifier si la table <strong>name</strong> existe pour la connexion <strong>con</strong>.</li>
<li><code>dbRemoveTable(con,name,...)</code> <span class="math inline">\(\Longrightarrow\)</span> effacer la table <strong>name</strong> de la connexion <strong>con</strong>.</li>
<li><code>dbGetRowsAffected(req,...)</code> <span class="math inline">\(\Longrightarrow\)</span> nombre de lignes affectés (extraction, effacement, modification) par la requête <strong>req</strong>.</li>
<li><code>dbGetRowCount(req,...)</code> <span class="math inline">\(\Longrightarrow\)</span> nombre de lignes collectées lors de la requête <strong>req</strong>.</li>
</ul>
</section>
<section id="requêter-avec-dplyr" class="level3" data-number="5.1.2">
<h3 data-number="5.1.2" class="anchored" data-anchor-id="requêter-avec-dplyr"><span class="header-section-number">5.1.2</span> Requêter avec dplyr</h3>
<p>L’approche présentée dans la partie précédente requiert des connaissances solides en SQL. Elle n’est pas forcément nécessaire puisqu’il est également possible d’utiliser <code>dplyr</code> (voir <a href="03-dplyr.html"><span>Chapitre&nbsp;3</span></a>) sur des bases SQL.</p>
<p>La fonction <strong>tbl</strong> permet notamment de se connecter à une table de la base de données.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>T1 <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con,<span class="st">"table1"</span>) </span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Il est intéressante de regarder la classe de l’objet construit :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(T1)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tbl_SQLiteConnection" "tbl_dbi"              "tbl_sql"             
[4] "tbl_lazy"             "tbl"                 </code></pre>
</div>
</div>
<p>Sans surprise on retrouve un tibble mais également la présence du mot <em>paresseux</em> (<em>lazy</em>). En affichant <code>T1</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>T1</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Source:   table&lt;table1&gt; [?? x 2]
# Database: sqlite 3.43.2 [:memory:]
   ID      age
   &lt;chr&gt; &lt;int&gt;
 1 P         5
 2 V        66
 3 E        47
 4 L        40
 5 O        84
 6 I        48
 7 X         3
 8 F        87
 9 Z        41
10 D        72
# ℹ more rows</code></pre>
</div>
</div>
<p>on remarque que le nombre de lignes n’est pas connu. En effet</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(T1)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA  2</code></pre>
</div>
</div>
<p>Lorsqu’elle s’applique à un tableau distant, une suite de commandes <code>dplyr</code> ne fait rien. En effet, la requête</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>(req <span class="ot">&lt;-</span> T1 <span class="sc">|&gt;</span> <span class="fu">filter</span>(age<span class="sc">&gt;</span><span class="dv">85</span>))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Source:   SQL [2 x 2]
# Database: sqlite 3.43.2 [:memory:]
  ID      age
  &lt;chr&gt; &lt;int&gt;
1 F        87
2 M        96</code></pre>
</div>
</div>
<p>ne peut être utilisé directement sur <strong>R</strong>. Par exemple</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>req<span class="sc">$</span>age<span class="sc">+</span><span class="dv">1</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `req$age`:
! The `$` method of &lt;tbl_lazy&gt; is for internal use only.
ℹ Use `dplyr::pull()` to get the values in a column.</code></pre>
</div>
</div>
<p>Ce n’est que lorsqu’on demande un résultat que <code>dplyr</code> effectue une action. On peut le faire avec la fonction <strong>collect</strong> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">collect</span>(req)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(res)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>res<span class="sc">$</span>age<span class="sc">+</span><span class="dv">1</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 88 97</code></pre>
</div>
</div>
<p>Ce principe d’évaluation retardée se retrouver fréquemment dans <strong>R</strong> sous le nom d’évaluation paresseuse, d’où <code>lazy</code> dans <code>tbl_lazy</code>.</p>
<p>Notons qu’on peut visualiser la requête construite avec la fonction <strong>show_query</strong> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>req <span class="sc">|&gt;</span> <span class="fu">show_query</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQL&gt;
SELECT `table1`.*
FROM `table1`
WHERE (`age` &gt; 85.0)</code></pre>
</div>
</div>
<p>Enfin, on n’oublie pas de se déconnecter de la base à la fin de l’étude :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="exercices" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="exercices"><span class="header-section-number">5.2</span> Exercices</h2>
<div id="exr-sql-velostar" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercice 5.1 (Le vélo star) </strong></span>On s’intéresse dans cet exercice aux données sur les stations velib présentes sur le site de Rennes Métropole <a href="https://data.rennesmetropole.fr/explore/?sort=modified" class="uri">https://data.rennesmetropole.fr/explore/?sort=modified</a>. Plus particulièreement, aux tables</p>
<ul>
<li><p><a href="https://data.rennesmetropole.fr/explore/dataset/etat-des-stations-le-velo-star-en-temps-reel/information/">Etat</a> qui propose des informations sur l’état des stations velib en temps réel</p></li>
<li><p><a href="https://data.rennesmetropole.fr/explore/dataset/topologie-des-stations-le-velo-star0/information/">Topologie</a> qui contient la liste des stations et la géolocalisation.</p></li>
</ul>
<ol type="1">
<li><p>Créer une base de données SQL qui contient ces deux tables et connectez vous à cette base.</p>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>etat <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(<span class="st">"data/etat_velib_rennes.csv"</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>topologie <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(<span class="st">"data/topologie_velib_rennes.csv"</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co">#con &lt;- dbConnect(RSQLite::SQLite(), dbname = "data/velib_rennes.sqlite")</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(RSQLite<span class="sc">::</span><span class="fu">SQLite</span>(), <span class="at">dbname =</span> <span class="st">":memory:"</span>)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dbWriteTable</span>(con,<span class="st">"etat"</span>,etat)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dbWriteTable</span>(con,<span class="st">"topologie"</span>,topologie)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="corR">
<p>On peut maintenant se connecter :</p>
</div>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbListTables</span>(con)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "etat"      "topologie"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(table <span class="cf">in</span> <span class="fu">dbListTables</span>(con)) {</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"--- Table"</span>, table, <span class="st">"---</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">dbListFields</span>(con, table))</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--- Table etat ---
[1] "Station (ID)"             "Nom"                     
[3] "Coordonnées"              "Etat"                    
[5] "Emplacements actuels"     "Emplacements disponibles"
[7] "Vélos disponibles"        "Dernière mise à jour"    
--- Table topologie ---
 [1] "Identifiant"                            
 [2] "Date de début de version"               
 [3] "Date de fin de version"                 
 [4] "Est la version active"                  
 [5] "Code"                                   
 [6] "Nom"                                    
 [7] "Adresse (numéro)"                       
 [8] "Adresse (voie)"                         
 [9] "Commune (code INSEE)"                   
[10] "Commune (nom)"                          
[11] "Coordonnées"                            
[12] "Station de métro en correspondance (ID)"
[13] "Emplacements"                           
[14] "Station la plus proche 1 (ID)"          
[15] "Station la plus proche 2 (ID)"          
[16] "Station la plus proche 3 (ID)"          
[17] "Avec terminal CB"                       </code></pre>
</div>
</div></li>
<li><p>Sélectionner l’identifiant <code>Identifiant</code>, le nom <code>Nom</code> et l’identifiant de la station proche <code>Station la plus proche 1 (ID)</code> depuis la table <code>topologie</code>.</p>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>query <span class="ot">&lt;-</span> <span class="st">"SELECT Identifiant, Nom, `Station la plus proche 1 (ID)` FROM topologie"</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(con, query) <span class="sc">|&gt;</span>  <span class="fu">head</span>(<span class="dv">3</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Identifiant               Nom Station la plus proche 1 (ID)
1        5516     Champs Libres                          5584
2        5517 Charles de Gaulle                          5516
3        5520    Pont de Nantes                          5543</code></pre>
</div>
</div></li>
<li><p>Faire une jointure pour créer une table qui contient la liste des stations avec l’identifiant, le nom et le nom de la station la plus proche.</p>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>query <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT left.identifiant AS Identifiant,</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="st">       left.Nom AS nom,</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="st">       right.Nom AS nom_proche</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="st">FROM topologie AS left</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="st">LEFT JOIN topologie AS right</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="st">ON (left.`Station la plus proche 1 (ID)` = right.Identifiant)"</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(con, query) <span class="sc">|&gt;</span>  <span class="fu">head</span>(<span class="dv">3</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Identifiant               nom      nom_proche
1        5516     Champs Libres            &lt;NA&gt;
2        5517 Charles de Gaulle   Champs Libres
3        5520    Pont de Nantes Cité Judiciaire</code></pre>
</div>
</div></li>
<li><p>Ajouter à la table précédente la distance euclidienne entre la station et la station proche associée à l’identifiant <code>Station la plus proche 1 (ID)</code> de la table <code>Topologie</code>.</p>
<div class="corR">
<p>On commence par créer les colonnes latitude et longitude :</p>
</div>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># une seule colonne en sqlite</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>query_add_latitude <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="st">ALTER TABLE topologie </span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="st">ADD COLUMN latitude DOUBLE</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="st">;</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="st">"</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(con, query_add_latitude)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>query_add_longitude <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="st">ALTER TABLE topologie </span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="st">ADD COLUMN longitude DOUBLE</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="st">;</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="st">"</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(con, query_add_longitude)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>query_update_lon_lat <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="st">UPDATE topologie SET latitude = SUBSTR(`Coordonnées`, 1, INSTR(`Coordonnées`, ',') - 1), </span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="st">                     longitude=SUBSTR(`Coordonnées`, INSTR(`Coordonnées`, ' ') + 1);"</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(con, query_update_lon_lat)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 57</code></pre>
</div>
</div>
<div class="corR">
<p>On peut maintenant calculer la distance :</p>
</div>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>query <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT left.identifiant AS identifiant,</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="st">       left.nom AS nom,</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="st">       right.nom AS nom_proche,</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="st">       (</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="st">         POWER((left.latitude - right.latitude), 2.0) +</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="st">         POWER((left.longitude - right.longitude), 2.0)</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="st">       ) AS distance</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="st">FROM topologie AS left</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="st">LEFT JOIN topologie AS right</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="st">ON (left.`Station la plus proche 1 (ID)` = right.identifiant)</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a><span class="st">"</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(con, query) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">3</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  identifiant               nom      nom_proche     distance
1        5516     Champs Libres            &lt;NA&gt;           NA
2        5517 Charles de Gaulle   Champs Libres 7.971157e-06
3        5520    Pont de Nantes Cité Judiciaire 7.604561e-06</code></pre>
</div>
</div></li>
<li><p>Nous nous trouvons au point de coordonnées (48.1179151,-1.7028661). Créer une table avec le nom des trois stations les plus proches classées par ordre de distance et le nombre d’emplacements libres dans ces stations.</p>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>query_add_latitude <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="st">ALTER TABLE etat </span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="st">ADD COLUMN latitude DOUBLE</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="st">;</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="st">"</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(con, query_add_latitude)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>query_add_longitude <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="st">ALTER TABLE etat </span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="st">ADD COLUMN longitude DOUBLE</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="st">;</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="st">"</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(con, query_add_longitude)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>query_update_lon_lat <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="st">UPDATE etat SET latitude = SUBSTR(`Coordonnées`, 1, INSTR(`Coordonnées`, ',') - 1), longitude=SUBSTR(`Coordonnées`, INSTR(`Coordonnées`, ' ') + 1);"</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(con, query_update_lon_lat)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 57</code></pre>
</div>
</div>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>ma_latitude <span class="ot">&lt;-</span> <span class="fl">48.1179151</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>ma_longitude <span class="ot">=</span> <span class="sc">-</span><span class="fl">1.7028661</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>query <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT nom,</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="st">       (</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="st">         POWER((latitude - "</span>, ma_latitude, <span class="st">"), 2.0) +</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="st">         POWER((longitude - "</span>, ma_longitude, <span class="st">"), 2.0)</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="st">       ) AS distance,</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="st">       `emplacements disponibles`</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a><span class="st">FROM Etat</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a><span class="st">ORDER BY distance</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="st">LIMIT 3</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(con, query)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   Nom     distance Emplacements disponibles
1               Berger 7.540436e-06                        3
2 Villejean-Université 1.197776e-05                       14
3              Marbeuf 3.864347e-05                       11</code></pre>
</div>
</div></li>
<li><p>Reprendre les questions précédentes en utilisant les fonctions de <code>dplyr</code>.</p>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>db_etat <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con, <span class="st">"Etat"</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(db_etat)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Station (ID)"             "Nom"                     
 [3] "Coordonnées"              "Etat"                    
 [5] "Emplacements actuels"     "Emplacements disponibles"
 [7] "Vélos disponibles"        "Dernière mise à jour"    
 [9] "latitude"                 "longitude"               </code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>db_topologie <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con, <span class="st">"Topologie"</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(db_topologie)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Identifiant"                            
 [2] "Date de début de version"               
 [3] "Date de fin de version"                 
 [4] "Est la version active"                  
 [5] "Code"                                   
 [6] "Nom"                                    
 [7] "Adresse (numéro)"                       
 [8] "Adresse (voie)"                         
 [9] "Commune (code INSEE)"                   
[10] "Commune (nom)"                          
[11] "Coordonnées"                            
[12] "Station de métro en correspondance (ID)"
[13] "Emplacements"                           
[14] "Station la plus proche 1 (ID)"          
[15] "Station la plus proche 2 (ID)"          
[16] "Station la plus proche 3 (ID)"          
[17] "Avec terminal CB"                       
[18] "latitude"                               
[19] "longitude"                              </code></pre>
</div>
</div>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>db_topologie <span class="sc">|&gt;</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Identifiant, Nom, <span class="st">`</span><span class="at">Station la plus proche 1 (ID)</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  Identifiant Nom               `Station la plus proche 1 (ID)`
        &lt;dbl&gt; &lt;chr&gt;                                       &lt;dbl&gt;
1        5516 Champs Libres                                5584
2        5517 Charles de Gaulle                            5516
3        5520 Pont de Nantes                               5543</code></pre>
</div>
</div>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>db_topologie <span class="sc">|&gt;</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(db_topologie, <span class="at">by =</span> <span class="fu">join_by</span>(<span class="st">`</span><span class="at">Station la plus proche 1 (ID)</span><span class="st">`</span> <span class="sc">==</span> Identifiant)) <span class="sc">|&gt;</span> </span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Nom =</span> Nom.x, <span class="at">nom_proche =</span> Nom.y) <span class="sc">|&gt;</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Identifiant, Nom, nom_proche) <span class="sc">|&gt;</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  Identifiant Nom               nom_proche     
        &lt;dbl&gt; &lt;chr&gt;             &lt;chr&gt;          
1        5516 Champs Libres     &lt;NA&gt;           
2        5517 Charles de Gaulle Champs Libres  
3        5520 Pont de Nantes    Cité Judiciaire</code></pre>
</div>
</div>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>db_topologie <span class="sc">|&gt;</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(db_topologie, <span class="at">by =</span> <span class="fu">join_by</span>(<span class="st">`</span><span class="at">Station la plus proche 1 (ID)</span><span class="st">`</span> <span class="sc">==</span> Identifiant)) <span class="sc">|&gt;</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">distance =</span> (latitude.x <span class="sc">-</span> latitude.y)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (longitude.x <span class="sc">-</span> longitude.y)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">nom =</span> Nom.x, <span class="at">nom_proche =</span> Nom.y) <span class="sc">|&gt;</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Identifiant, nom, nom_proche, distance) <span class="sc">|&gt;</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  Identifiant nom               nom_proche         distance
        &lt;dbl&gt; &lt;chr&gt;             &lt;chr&gt;                 &lt;dbl&gt;
1        5516 Champs Libres     &lt;NA&gt;            NA         
2        5517 Charles de Gaulle Champs Libres    0.00000797
3        5520 Pont de Nantes    Cité Judiciaire  0.00000760</code></pre>
</div>
</div>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>db_etat <span class="sc">|&gt;</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">distance =</span> (latitude <span class="sc">-</span> ma_latitude)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (longitude <span class="sc">-</span> ma_longitude)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(distance) <span class="sc">|&gt;</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Nom, distance, <span class="st">`</span><span class="at">Emplacements disponibles</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  Nom                    distance `Emplacements disponibles`
  &lt;chr&gt;                     &lt;dbl&gt;                      &lt;dbl&gt;
1 Berger               0.00000754                          3
2 Villejean-Université 0.0000120                          14
3 Marbeuf              0.0000386                          11</code></pre>
</div>
</div></li>
<li><p>Viualiser les 3 stations de la question 5 sur une carte <code>mapview</code>.</p>
<div class="corR">
<p>On créé tout d’abors un objet <code>sf</code> avec les informations nécessaires :</p>
</div>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>stations <span class="ot">&lt;-</span> </span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  db_etat <span class="sc">|&gt;</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">distance =</span> (latitude <span class="sc">-</span> ma_latitude)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (longitude <span class="sc">-</span> ma_longitude)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(distance) <span class="sc">|&gt;</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(Nom, distance, <span class="st">`</span><span class="at">Emplacements disponibles</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">head</span>(<span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">collect</span>()</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>stations1 <span class="ot">&lt;-</span> stations <span class="sc">|&gt;</span> </span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(<span class="fu">collect</span>(db_etat),<span class="at">by=</span><span class="fu">join_by</span>(Nom<span class="sc">==</span>Nom)) <span class="sc">|&gt;</span> </span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Dispo=</span><span class="st">`</span><span class="at">Emplacements disponibles.x</span><span class="st">`</span>) <span class="sc">|&gt;</span> </span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Nom,Dispo,longitude,latitude)</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>sta_geom <span class="ot">&lt;-</span> stations1 <span class="sc">|&gt;</span> </span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>,<span class="st">"latitude"</span>),<span class="at">crs=</span><span class="dv">4326</span>)</span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>sta_geom</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 3 features and 2 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -1.705097 ymin: 48.11175 xmax: -1.702077 ymax: 48.12107
Geodetic CRS:  WGS 84
# A tibble: 3 × 3
  Nom                  Dispo             geometry
* &lt;chr&gt;                &lt;dbl&gt;          &lt;POINT [°]&gt;
1 Berger                   3 (-1.705097 48.11631)
2 Villejean-Université    14  (-1.70428 48.12107)
3 Marbeuf                 11 (-1.702077 48.11175)</code></pre>
</div>
</div>
<div class="corR">
<p>On construit la carte</p>
</div>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>mapview<span class="sc">::</span><span class="fu">mapview</span>(sta_geom,</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">cex=</span><span class="st">"Dispo"</span>,</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">popup=</span>leafpop<span class="sc">::</span><span class="fu">popupTable</span>(stations1,</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">zcol=</span><span class="fu">c</span>(<span class="st">"Nom"</span>,<span class="st">"Dispo"</span>)),</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">legend=</span><span class="cn">FALSE</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div class="leaflet html-widget html-fill-item" id="htmlwidget-e0f29c401db8dbab3cd2" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-e0f29c401db8dbab3cd2">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["point",440]},{"method":"addCircleMarkers","args":[[48.116314,48.121074,48.111749],[-1.705097,-1.70428,-1.702077],[3,15,11.72727272727273],null,"sta_geom",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"point","stroke":true,"color":"#333333","weight":1,"opacity":0.9,"fill":true,"fillColor":"#6666FF","fillOpacity":0.6},null,null,["<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>1&emsp;<\/td><\/tr><tr><td>1<\/td><th>Nom&emsp;<\/th><td>Berger&emsp;<\/td><\/tr><tr><td>2<\/td><th>Dispo&emsp;<\/th><td> 3&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>2&emsp;<\/td><\/tr><tr><td>1<\/td><th>Nom&emsp;<\/th><td>Villejean-Université&emsp;<\/td><\/tr><tr><td>2<\/td><th>Dispo&emsp;<\/th><td>14&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>3&emsp;<\/td><\/tr><tr><td>1<\/td><th>Nom&emsp;<\/th><td>Marbeuf&emsp;<\/td><\/tr><tr><td>2<\/td><th>Dispo&emsp;<\/th><td>11&emsp;<\/td><\/tr><\/table><\/div>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["1","2","3"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[-1.705097,48.111749,-1.702077,48.121074,true,"sta_geom","Zoom to sta_geom","<strong> sta_geom <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],"sta_geom",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]}],"limits":{"lat":[48.111749,48.121074],"lng":[-1.705097,-1.702077]},"fitBounds":[48.111749,-1.705097,48.121074,-1.702077,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
</div>
</div></li>
<li><p>Terminer correctement en fermant la connexion à la base de données.</p>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ol>
</div>
<div id="exr-sql-musique" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercice 5.2 (Un peu de musique) </strong></span>Sur le site https://github.com/lerocha/chinook-database, nous pouvons trouver des bases de données de bibliothèques musicales. Une copie de la base SQLite est disponible dans le fichier <code>Chinook_Sqlite.sqlite</code>.</p>
<ol type="1">
<li><p>Se connecter à la base de données et afficher les tables. Explorer le jeu de données pour le découvrir. En particulier, étudier comment les tables <code>Playlist</code>, <code>PlaylistTrack</code> et <code>Track</code> sont liées.</p>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(RSQLite<span class="sc">::</span><span class="fu">SQLite</span>(), <span class="at">dbname =</span> <span class="st">"data/Chinook_Sqlite.sqlite"</span>)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dbListTables</span>(con)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Album"         "Artist"        "Customer"      "Employee"     
 [5] "Genre"         "Invoice"       "InvoiceLine"   "MediaType"    
 [9] "Playlist"      "PlaylistTrack" "Track"        </code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>db_playlist <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con, <span class="st">"Playlist"</span>)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>db_playlist <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">3</span>) <span class="sc">|&gt;</span> <span class="fu">collect</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  PlaylistId Name    
       &lt;int&gt; &lt;chr&gt;   
1          1 Music   
2          2 Movies  
3          3 TV Shows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>db_playlist_track <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con, <span class="st">"PlaylistTrack"</span>)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>db_playlist_track <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">3</span>) <span class="sc">|&gt;</span> <span class="fu">collect</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  PlaylistId TrackId
       &lt;int&gt;   &lt;int&gt;
1          1    3402
2          1    3389
3          1    3390</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>db_track <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con, <span class="st">"Track"</span>)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>db_track <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">3</span>) <span class="sc">|&gt;</span> <span class="fu">collect</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 9
  TrackId Name          AlbumId MediaTypeId GenreId Composer Milliseconds  Bytes
    &lt;int&gt; &lt;chr&gt;           &lt;int&gt;       &lt;int&gt;   &lt;int&gt; &lt;chr&gt;           &lt;int&gt;  &lt;int&gt;
1       1 For Those Ab…       1           1       1 Angus Y…       343719 1.12e7
2       2 Balls to the…       2           2       1 &lt;NA&gt;           342562 5.51e6
3       3 Fast As a Sh…       3           2       1 F. Balt…       230619 3.99e6
# ℹ 1 more variable: UnitPrice &lt;dbl&gt;</code></pre>
</div>
</div></li>
<li><p>Utiliser les verbes de <code>dplyr</code> pour savoir quelles sont les playlists qui contiennent le plus de pistes.</p>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>db_playlist_track <span class="sc">|&gt;</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(PlaylistId) <span class="sc">|&gt;</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(db_playlist, <span class="at">by =</span> <span class="st">"PlaylistId"</span>) <span class="sc">|&gt;</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">|&gt;</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 3
   PlaylistId     n Name                      
        &lt;int&gt; &lt;int&gt; &lt;chr&gt;                     
 1          1  3290 Music                     
 2          8  3290 Music                     
 3          5  1477 90’s Music                
 4          3   213 TV Shows                  
 5         10   213 TV Shows                  
 6         12    75 Classical                 
 7         11    39 Brazilian Music           
 8         17    26 Heavy Metal Classic       
 9         13    25 Classical 101 - Deep Cuts 
10         14    25 Classical 101 - Next Steps
11         15    25 Classical 101 - The Basics
12         16    15 Grunge                    
13          9     1 Music Videos              
14         18     1 On-The-Go 1               </code></pre>
</div>
</div></li>
<li><p>En utilisant <code>dplyr</code>, construire une table contenant les informations suivantes sur la playlist appelée <code>Classical</code> : le titre de chaque piste ainsi que le titre de l’album dont cette piste est tirée.</p>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>db_album <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con, <span class="st">"Album"</span>)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>db_playlist_track <span class="sc">|&gt;</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(db_playlist, <span class="at">by =</span> <span class="st">"PlaylistId"</span>) <span class="sc">|&gt;</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">PlaylistName =</span> Name) <span class="sc">|&gt;</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PlaylistName <span class="sc">==</span> <span class="st">"Classical"</span>) <span class="sc">|&gt;</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(db_track, <span class="at">by =</span> <span class="st">"TrackId"</span>) <span class="sc">|&gt;</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(db_album, <span class="at">by =</span> <span class="st">"AlbumId"</span>) <span class="sc">|&gt;</span></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Name, Title) <span class="sc">|&gt;</span></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 75 × 2
   Name                                                                   Title 
   &lt;chr&gt;                                                                  &lt;chr&gt; 
 1 "Intoitus: Adorate Deum"                                               Adora…
 2 "Miserere mei, Deus"                                                   Alleg…
 3 "Canon and Gigue in D Major: I. Canon"                                 Pache…
 4 "Concerto No. 1 in E Major, RV 269 \"Spring\": I. Allegro"             Vival…
 5 "Concerto for 2 Violins in D Minor, BWV 1043: I. Vivace"               Bach:…
 6 "Aria Mit 30 Veränderungen, BWV 988 \"Goldberg Variations\": Aria"     Bach:…
 7 "Suite for Solo Cello No. 1 in G Major, BWV 1007: I. Prélude"          Bach:…
 8 "The Messiah: Behold, I Tell You a Mystery... The Trumpet Shall Sound" Hande…
 9 "Solomon HWV 67: The Arrival of the Queen of Sheba"                    The W…
10 "\"Eine Kleine Nachtmusik\" Serenade In G, K. 525: I. Allegro"         Sir N…
# ℹ 65 more rows</code></pre>
</div>
</div></li>
<li><p>Même question en écrivant directement la requête en SQL.</p>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>query <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT Name, Title</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="st">FROM (</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="st">  SELECT Name, AlbumId</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM (</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a><span class="st">    SELECT TrackId</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a><span class="st">    FROM PlaylistTrack AS left</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a><span class="st">    LEFT JOIN Playlist AS right</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a><span class="st">    ON (left.PlaylistId = right.PlaylistId)</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a><span class="st">    WHERE (Name = 'Classical')</span></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a><span class="st">  ) AS left</span></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a><span class="st">  LEFT JOIN Track AS right</span></span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a><span class="st">  ON (left.TrackId = right.TrackId)</span></span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a><span class="st">) AS left</span></span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a><span class="st">LEFT JOIN Album AS right</span></span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a><span class="st">ON (left.AlbumId = right.AlbumId)</span></span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a><span class="st">"</span></span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(con, query) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">3</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                  Name
1               Intoitus: Adorate Deum
2                   Miserere mei, Deus
3 Canon and Gigue in D Major: I. Canon
                                                      Title
1 Adorate Deum: Gregorian Chant from the Proper of the Mass
2                                         Allegri: Miserere
3                                  Pachelbel: Canon &amp; Gigue</code></pre>
</div>
</div></li>
<li><p>Terminer correctement en fermant la connexion à la base de données.</p>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ol>
</div>
</section>
<section id="json-javascript-object-notation" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="json-javascript-object-notation"><span class="header-section-number">5.3</span> JSON : JavaScript Object Notation</h2>
<p>Il s’agit d’une alternative aux bases de données relationnelles qui encode les infromations dans des fichiers structurés. Il est très utilisé dans :</p>
<ul>
<li>les bases de données NoSQL avec <strong>MongoDB</strong></li>
<li>les <strong>API WEB</strong></li>
<li>le monde de l’open data, par exemple sur le site des données publiques de l’état français <a href="https://www.data.gouv.fr/fr/" class="uri">https://www.data.gouv.fr/fr/</a>.</li>
</ul>
<p>Un fichier <strong>JSON</strong> est articulé autour d’une syntaxe simple et d’un petit nombre de type de données. Deux types sont <strong>structurés</strong>, les autres sont des types <strong>simples</strong>.</p>
<p>Les types structurés sont :</p>
<ul>
<li><p>les <strong>objets</strong>, proches des <em>dictionnaires</em> <strong>Python</strong> ou des listes <strong>R</strong>. Ils permettent de structurer les données selon un principe clé/valeur et sont codés de la façon suivante :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"clé1"</span><span class="sc">:</span> valeur1,</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"clé2"</span><span class="sc">:</span> valeur2,</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>  ...</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>les tableaux, proches des <em>listes</em> <strong>Python</strong> ou des vecteurs <strong>R</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>[</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  valeur1,</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  valeur2,</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>  ...</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
<p>Les valeurs peuvent prendre différents types comme des chaînes de caractères, des nombres, des booléens… Par exemple</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"prénom"</span><span class="sc">:</span> <span class="st">"Jean-Sébastien"</span>,</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"nom"</span><span class="sc">:</span> <span class="st">"Bach"</span>,</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"nombre_enfants"</span><span class="sc">:</span> <span class="dv">20</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"compositeur"</span><span class="sc">:</span> true</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Sur <strong>R</strong>, la manipulation du format JSON se fait avec le package <code>jsonlite</code>. Il propose notamment les fonctions :</p>
<ul>
<li><code>fromJSON</code> pour importer du texte ou des fichier au format JSON ;</li>
<li><code>toJSON</code> pour exporter au format JSON.</li>
</ul>
<p>Par exemple</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, pi),<span class="at">y =</span> <span class="fu">cos</span>(x))</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="fu">toJSON</span>(df);<span class="fu">class</span>(df)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[{"x":0,"y":1},{"x":3.1416,"y":-1}] </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
</div>
<p>et</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span> <span class="fu">toJSON</span>() <span class="sc">|&gt;</span> <span class="fu">fromJSON</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       x  y
1 0.0000  1
2 3.1416 -1</code></pre>
</div>
</div>
<div id="exr-json-intro" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercice 5.3 (Première commandes) </strong></span>&nbsp;</p>
<ol type="1">
<li><p>On considère les données suivantes :</p>
<p>Construire dans <strong>R</strong> un tableau au format JSON et le convertir en <code>tibble</code> à l’aide de la fonction <code>fromJSON</code>.</p>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fromJSON</span>(<span class="st">'[{"nom": "Peter","age": 24},</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="st">           {"nom": "Marie","age": 18},</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="st">           {"nom": "Eric","age": 32}</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="st">         ]'</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    nom age
1 Peter  24
2 Marie  18
3  Eric  32</code></pre>
</div>
</div></li>
<li><p>On construit l’objet suivant :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>aa <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">'[{</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="st">      "prénom": "Jean-Sébastien",</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="st">      "nom": "Bach",</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a><span class="st">      "épouses": [</span></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a><span class="st">        {</span></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a><span class="st">          "prénom": ["Maria", "Barbara"],</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a><span class="st">          "nom": "Bach"</span></span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a><span class="st">        },</span></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a><span class="st">        {</span></span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a><span class="st">          "prénom": ["Anna", "Magdalena"],</span></span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a><span class="st">          "nom": "Wilcke"</span></span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a><span class="st">        }]</span></span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a><span class="st">  }]'</span></span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Analyser cet objet et plus particulièrement la colonne <code>épouses</code>.</p>
<div class="corR">
<p>On observe que l’objet suivant est un data-frame avec une ligne et 3 colonnes. Néanmoins l’élement de la troisième colonne est étrange lorsqu’il s’affiche :</p>
</div>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(aa)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(aa)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>aa</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          prénom  nom                                       épouses
1 Jean-Sébastien Bach Maria, Barbara, Anna, Magdalena, Bach, Wilcke</code></pre>
</div>
</div>
<div class="corR">
<p>Il s’agit d’une liste qui contient un data-frame :</p>
</div>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(aa[<span class="dv">1</span>,<span class="dv">3</span>])</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "list"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(aa[<span class="dv">1</span>,<span class="dv">3</span>][[<span class="dv">1</span>]])</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>aa[<span class="dv">1</span>,<span class="dv">3</span>][[<span class="dv">1</span>]]</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           prénom    nom
1  Maria, Barbara   Bach
2 Anna, Magdalena Wilcke</code></pre>
</div>
</div>
<div class="corR">
<p>On peut retrouver ces informations avec la fonction <code>glimpse</code>:</p>
</div>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(aa)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1
Columns: 3
$ prénom  &lt;chr&gt; "Jean-Sébastien"
$ nom     &lt;chr&gt; "Bach"
$ épouses &lt;list&gt; [&lt;data.frame[2 x 2]&gt;]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(aa[<span class="dv">1</span>,<span class="dv">3</span>])</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 1
 $ :'data.frame':   2 obs. of  2 variables:
  ..$ prénom:List of 2
  .. ..$ : chr [1:2] "Maria" "Barbara"
  .. ..$ : chr [1:2] "Anna" "Magdalena"
  ..$ nom   : chr [1:2] "Bach" "Wilcke"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(aa[<span class="dv">1</span>,<span class="dv">3</span>][[<span class="dv">1</span>]])</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 2
Columns: 2
$ prénom &lt;list&gt; &lt;"Maria", "Barbara"&gt;, &lt;"Anna", "Magdalena"&gt;
$ nom    &lt;chr&gt; "Bach", "Wilcke"</code></pre>
</div>
</div></li>
</ol>
</div>
<div id="exr-json-velostar" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercice 5.4 (Importation JSON et API) </strong></span>On s’intéresse aux données sur l’état des stations de vélo à Rennes disponibles ici : <a href="https://data.rennesmetropole.fr/explore/dataset/etat-des-stations-le-velo-star-en-temps-reel/information/" class="uri">https://data.rennesmetropole.fr/explore/dataset/etat-des-stations-le-velo-star-en-temps-reel/information/</a>.</p>
<ol type="1">
<li><p>Télécharger le fichier <code>json</code> qui contient ces données et les importer dans <strong>R</strong> avec <code>fromJSON</code>.</p>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>etat <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="st">"data/etat-des-stations-le-velo-star-rennes.json"</span>)</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(etat)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 57
Columns: 8
$ idstation                     &lt;chr&gt; "5505", "5506", "5501", "5509", "5507", …
$ nom                           &lt;chr&gt; "Sainte-Anne", "Hôtel Dieu", "République…
$ coordonnees                   &lt;df[,2]&gt; &lt;data.frame[26 x 2]&gt;
$ etat                          &lt;list&gt; "En fonctionnement", "En fonctionneme…
$ nombreemplacementsactuels     &lt;int&gt; 24, 26, 45, 18, 31, 24, 16, 20, 39, 24,…
$ nombreemplacementsdisponibles &lt;int&gt; 17, 21, 35, 13, 26, 7, 12, 12, 13, 13, 1…
$ nombrevelosdisponibles        &lt;int&gt; 7, 5, 10, 5, 5, 17, 4, 8, 26, 11, 22, 2,…
$ lastupdate                    &lt;chr&gt; "2024-01-15T08:45:17+01:00", "2024-01-15…</code></pre>
</div>
</div></li>
<li><p>Analyser la colonne qui contient la géolocalisation de la station.</p>
<div class="corR">
<p>La colonne <code>coordonnees</code> contient un <code>data-frame</code> à deux colonnes où on pourra lire les longitudes et latitude.</p>
</div>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(etat<span class="sc">$</span>coordonnees)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      lon              lat       
 Min.   :-1.705   Min.   :48.09  
 1st Qu.:-1.685   1st Qu.:48.11  
 Median :-1.675   Median :48.11  
 Mean   :-1.674   Mean   :48.11  
 3rd Qu.:-1.664   3rd Qu.:48.12  
 Max.   :-1.634   Max.   :48.13  </code></pre>
</div>
</div></li>
<li><p>Importer les données en utilisant l’<strong>API</strong> proposée sur le site. On importera uniquement les colonnes qui contiennent le <em>nom</em>, la <em>géolocalisation</em> et le <em>nombre d’emplacements disponibles</em> des stations.</p>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>lien <span class="ot">&lt;-</span> <span class="st">"https://data.rennesmetropole.fr/api/explore/v2.1/catalog/datasets/etat-des-stations-le-velo-star-en-temps-reel/records?select=nom%2C%20coordonnees%2C%20nombreemplacementsdisponibles&amp;limit=100"</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>etat2 <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">url</span>(lien))</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>etat3 <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(etat2<span class="sc">$</span>results) <span class="sc">|&gt;</span> </span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">dispo=</span>nombreemplacementsdisponibles)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>Visualiser les stations sur une carte <code>mapview</code>.</p>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>etat_geom <span class="ot">&lt;-</span> etat3 <span class="sc">|&gt;</span> </span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(coordonnees) <span class="sc">|&gt;</span> </span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">|&gt;</span> </span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_multipoint</span>() <span class="sc">|&gt;</span> </span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_geometry</span>() <span class="sc">|&gt;</span> </span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="at">to=</span><span class="st">"POINT"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_sfc</span>(<span class="at">crs=</span><span class="dv">4326</span>)</span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry</span>(etat3) <span class="ot">&lt;-</span> etat_geom</span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>etat3</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 57 features and 3 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -1.705097 ymin: 48.08731 xmax: -1.633875 ymax: 48.12995
Geodetic CRS:  WGS 84
# A tibble: 57 × 4
   nom                   coordonnees$lon  $lat dispo             geometry
   &lt;chr&gt;                           &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;          &lt;POINT [°]&gt;
 1 Sainte-Anne                     -1.68  48.1    13 (-1.680461 48.11421)
 2 Saint-Georges Piscine           -1.67  48.1    14 (-1.674417 48.11239)
 3 Musée Beaux-Arts                -1.67  48.1     7   (-1.67408 48.1096)
 4 Bonnets Rouges                  -1.67  48.1    21 (-1.665814 48.10685)
 5 Charles de Gaulle               -1.68  48.1    15 (-1.677119 48.10511)
 6 Colombier                       -1.68  48.1    16  (-1.680594 48.1061)
 7 Pont de Nantes                  -1.68  48.1     5 (-1.684015 48.10202)
 8 Oberthur                        -1.66  48.1    22 (-1.661853 48.11355)
 9 Auberge de Jeunesse             -1.68  48.1    20 (-1.681876 48.12088)
10 Croix Saint-Hélier              -1.66  48.1    12  (-1.66209 48.10305)
# ℹ 47 more rows</code></pre>
</div>
</div>
<div class="cell" data-teacher="true">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>mapview<span class="sc">::</span><span class="fu">mapview</span>(etat3,</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">cex=</span><span class="st">"dispo"</span>,</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">popup=</span>leafpop<span class="sc">::</span><span class="fu">popupTable</span>(etat3,</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">zcol=</span><span class="fu">c</span>(<span class="st">"nom"</span>,<span class="st">"dispo"</span>)),</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">legend=</span><span class="cn">FALSE</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div class="leaflet html-widget html-fill-item" id="htmlwidget-09948ccb1c5e20f4ac09" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-09948ccb1c5e20f4ac09">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["point",440]},{"method":"addCircleMarkers","args":[[48.11421,48.112385,48.109601,48.106846,48.105111,48.106103,48.102015,48.11355,48.120876,48.10305,48.109926,48.121906,48.089978,48.091114,48.123506,48.087309,48.099043,48.129949,48.102055,48.105086,48.117596,48.118172,48.106653,48.1097,48.111564,48.108765,48.11817,48.110115,48.112461,48.128788,48.097505,48.093292,48.091594,48.109859,48.098086,48.10432,48.110026,48.111624,48.115074,48.107748,48.105537,48.112766,48.113009,48.110264,48.111749,48.121481,48.104771,48.115993,48.116458,48.121074,48.128453,48.116314,48.094986,48.125408,48.129464,48.124389,48.10995],[-1.680461,-1.674417,-1.67408,-1.665814,-1.677119,-1.680594,-1.684015,-1.661853,-1.681876,-1.66209,-1.659499,-1.639783,-1.690244,-1.682284,-1.659762,-1.643683,-1.694512,-1.676161,-1.673959,-1.693069,-1.677849,-1.670735,-1.68677,-1.684041,-1.689656,-1.693432,-1.688466,-1.670039,-1.643674,-1.698129,-1.674834,-1.674116,-1.667321,-1.656028,-1.655278,-1.673312,-1.678037,-1.678757,-1.677073,-1.673711,-1.674328,-1.685037,-1.693264,-1.664443,-1.702077,-1.692737,-1.68411,-1.658258,-1.633875,-1.70428,-1.694032,-1.705097,-1.663731,-1.664806,-1.657272,-1.651203,-1.647933],[5.634146341463415,5.926829268292683,3.878048780487805,7.975609756097561,6.219512195121951,6.512195121951219,3.292682926829269,8.26829268292683,7.682926829268293,5.341463414634147,6.804878048780488,10.31707317073171,6.219512195121951,5.926829268292683,6.804878048780488,4.75609756097561,5.634146341463415,6.804878048780488,5.926829268292683,4.463414634146341,6.219512195121951,10.02439024390244,7.682926829268293,8.560975609756099,4.75609756097561,5.926829268292683,8.26829268292683,5.048780487804878,6.512195121951219,7.097560975609756,7.682926829268293,4.170731707317073,5.048780487804878,5.341463414634147,5.048780487804878,15,7.682926829268293,5.048780487804878,8.26829268292683,5.926829268292683,5.634146341463415,7.975609756097561,3.878048780487805,7.390243902439025,3,8.26829268292683,6.512195121951219,4.170731707317073,8.560975609756099,6.804878048780488,7.390243902439025,3.585365853658537,3.878048780487805,5.926829268292683,7.682926829268293,7.097560975609756,5.926829268292683],null,"etat3",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"point","stroke":true,"color":"#333333","weight":1,"opacity":0.9,"fill":true,"fillColor":"#6666FF","fillOpacity":0.6},null,null,["<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>1&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Sainte-Anne&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>13&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>2&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Saint-Georges Piscine&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>14&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>3&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Musée Beaux-Arts&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td> 7&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>4&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Bonnets Rouges&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>21&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>5&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Charles de Gaulle&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>15&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>6&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Colombier&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>16&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>7&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Pont de Nantes&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td> 5&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>8&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Oberthur&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>22&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>9&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Auberge de Jeunesse&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>20&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>10&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Croix Saint-Hélier&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>12&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>11&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Robidou&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>17&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>12&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Beaulieu - Université&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>29&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>13&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Bréquigny Piscine&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>15&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>14&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Champs Manceaux&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>14&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>15&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Painlevé&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>17&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>16&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>La Poterie&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>10&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>17&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>La Courrouze&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>13&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>18&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Armorique&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>17&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>19&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Gare Sud Féval&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>14&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>20&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Mabilais&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td> 9&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>21&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Hôtel Dieu&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>15&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>22&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Jules Ferry&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>28&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>23&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>La Rotonde&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>20&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>24&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Place de Bretagne&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>23&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>25&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Horizons&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>10&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>26&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Chèques Postaux&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>14&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>27&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Anatole France&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>22&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>28&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Paul Bert&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>11&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>29&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Plaine de Baud&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>16&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>30&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Cucillé - Frac&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>18&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>31&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Jacques Cartier&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>20&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>32&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Clemenceau&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td> 8&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>33&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Binquenais&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>11&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>34&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Pont de Strasbourg&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>12&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>35&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Bourgeois&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>11&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>36&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Gares&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>45&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>37&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>République&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>20&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>38&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Mairie - Opéra&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>11&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>39&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Place Hoche&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>22&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>40&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>TNB&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>14&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>41&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Champs Libres&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>13&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>42&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Les Lices&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>21&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>43&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Brest Verdun&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td> 7&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>44&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Pont de Châteaudun&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>19&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>45&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Marbeuf&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td> 4&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>46&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Pontchaillou&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>22&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>47&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Cité Judiciaire&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>16&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>48&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Metz - Sévigné&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td> 8&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>49&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Beaulieu Chimie&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>23&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>50&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Villejean-Université&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>17&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>51&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Préfecture&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>19&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>52&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Berger&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td> 6&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>53&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Sainte-Thérèse&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td> 7&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>54&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Gros-Chêne&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>14&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>55&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Les Gayeulles&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>20&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>56&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Joliot-Curie - Chateaubriand&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>18&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>57&emsp;<\/td><\/tr><tr><td>1<\/td><th>nom&emsp;<\/th><td>Baud Chardonnet&emsp;<\/td><\/tr><tr><td>2<\/td><th>dispo&emsp;<\/th><td>14&emsp;<\/td><\/tr><\/table><\/div>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[-1.705097,48.087309,-1.633875,48.129949,true,"etat3","Zoom to etat3","<strong> etat3 <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],"etat3",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]}],"limits":{"lat":[48.087309,48.129949],"lng":[-1.705097,-1.633875]},"fitBounds":[48.087309,-1.705097,48.129949,-1.633875,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
</div>
</div></li>
</ol>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copié");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copié");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./031-programmer.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Programmer</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./04-ggplot.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Visualisation avec ggplot2</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>